// Request status enum
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

// Request type enum
enum RequestType {
  INTERNSHIP
  PROJECT
  PERFORMANCE
  CO_CURRICULAR
}

model Request {
  id           String        @id @default(cuid())
  studentId    String
  type         RequestType
  targetId     String        // ID of the related entity (internship, project, etc.)
  status       RequestStatus @default(PENDING)
  remarks      String?
  feedback     String?       // HOD's feedback on approval/rejection
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  // Relations
  student      Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)
  hodId        String?
  hod          HOD?          @relation(fields: [hodId], references: [id])

  @@map("requests")
}
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Optional: User profile picture
  profilePicture String?
  // Account status (for future use)
  accountStatus  UserAccountStatus @default(ACTIVE)

  // Relations
  student  Student?
  faculty  Faculty?
  hod      HOD?
  admin    Admin?

  @@map("users")
  @@index([accountStatus])
}

enum UserAccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum StudentStatus {
  PURSUING
  PASSEDOUT
}

model Student {
  id                  String   @id @default(cuid())
  userId              String   @unique
  name                String
  aadhar              BigInt   @unique
  phoneNumber         String
  phoneCode           Int
  registrationNumber  Int      @unique
  rollNumber          Int      @unique
  passPort            String   @default("Not Available")
  emergencyContact    BigInt
  personalEmail       String   @unique
  collegeEmail        String   @unique
  dob                 DateTime
  address             String
  program             String
  branch              String
  bloodGroup          String
  dayScholar          Boolean
  fatherName          String
  fatherOccupation    String?
  fatherAadhar        BigInt?
  fatherNumber        BigInt?
  motherName          String
  motherOccupation    String?
  motherAadhar        BigInt?
  motherNumber        BigInt?
  gender              Gender
  community           Community
  xMarks              Int
  xiiMarks            Int
  jeeMains            Int
  jeeAdvanced         Int?
  status              StudentStatus @default(PURSUING)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Relations
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  internships         Internship[]
  personalProblem     PersonalProblem?
  projects            Project[]
  careerDetails       CareerDetails?
  coCurriculars       CoCurricular[]
  semesters           Semester[]
  requests            Request[]
  
  // Mentor relationships - one current mentor, many past mentors
  currentMentorId     String?  @unique
  currentMentor       Mentor?  @relation("StudentCurrentMentor", fields: [currentMentorId], references: [id])
  pastMentors         Mentor[] @relation("StudentPastMentors")

  @@map("students")
  @@index([registrationNumber])
  @@index([rollNumber])
}

model Faculty {
  id            String   @id @default(cuid())
  userId        String   @unique
  employeeId    String   @unique
  name          String
  phone1        BigInt
  phone2        BigInt?
  personalEmail String   @unique
  collegeEmail  String   @unique
  department    String
  btech         String?
  mtech         String?
  phd           String?
  office        String
  officeHours   String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  hod               HOD?
  
  // Mentor relationships - many current students, many past students
  currentMentorships Mentor[] @relation("FacultyCurrentMentorships")
  pastMentorships    Mentor[] @relation("FacultyPastMentorships")

  @@map("faculty")
}

model HOD {
  id         String   @id @default(cuid())
  userId     String   @unique
  facultyId  String   @unique
  department String
  startDate  DateTime
  endDate    DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  faculty  Faculty @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  requests  Request[]

  @@map("hods")
}

model Admin {
  id            String   @id @default(cuid())
  userId        String   @unique
  employeeId    String   @unique
  name          String
  phone         String
  personalEmail String   @unique
  collegeEmail  String   @unique
  department    String?
  designation   String
  office        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admins")
}

model Meeting {
  id           String   @id @default(cuid())
  mentorId     String
  date         DateTime
  time         String
  description  String?
  facultyReview String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  mentor  Mentor @relation(fields: [mentorId], references: [id], onDelete: Cascade)

  @@map("meetings")
}

model Mentor {
  id          String    @id @default(cuid())
  facultyId   String
  studentId   String
  year        Int       // Academic year (e.g., 1, 2, 3, 4)
  semester    Int       // Semester (e.g., 1-8)
  startDate   DateTime  @default(now())
  endDate     DateTime?
  isActive    Boolean   @default(true)
  comments    String[]  @default([])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  faculty          Faculty  @relation("FacultyCurrentMentorships", fields: [facultyId], references: [id], onDelete: Cascade)
  meetings         Meeting[]
  
  // Student relations - one student per mentor record
  currentStudent   Student? @relation("StudentCurrentMentor")
  pastStudents     Student[] @relation("StudentPastMentors")

  @@map("mentors")
  @@index([facultyId])
  @@index([studentId])
  @@index([isActive])
  @@index([year])
  @@index([semester])
}



model CareerDetails {
  id               String   @id @default(cuid())
  hobbies          String[] @default([])
  strengths        String[] @default([])
  areasToImprove   String[] @default([])
  core             String[] @default([])
  it               String[] @default([])
  higherEducation  String[] @default([])
  startup          String[] @default([])
  familyBusiness   String[] @default([])
  otherInterests   String[] @default([])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String  @unique

  @@map("career_details")
}

model PersonalProblem {
  id                               String   @id @default(cuid())
  stress                           Boolean?
  anger                            Boolean?
  emotionalProblem                 Boolean?
  lowSelfEsteem                    Boolean?
  examinationAnxiety               Boolean?
  negativeThoughts                 Boolean?
  examPhobia                       Boolean?
  stammering                       Boolean?
  financialProblem                 Boolean?
  moodSwings                       Boolean?
  disturbedRelationshipWithParents Boolean?
  disturbedRelationshipWithTeachers Boolean?
  disturbedRelationshipWithFriends Boolean?
  disciplinaryProblemsInCollege    Boolean?
  poorCommandOfEnglish             Boolean?
  tobaccoOrAlcoholUse              Boolean?
  suicidalAttemptsOrThoughts       Boolean?
  disappointmentWithCourses        Boolean?
  timeManagementProblem            Boolean?
  relationshipProblem               Boolean?
  lowSelfMotivation                Boolean?
  conflicts                        Boolean?
  procrastination                  Boolean?
  frustration                      Boolean?
  poorDecisivePower                Boolean?
  adjustmentProblem                Boolean?
  lackOfExpression                 Boolean?
  poorConcentration                Boolean?
  stagePhobia                      Boolean?
  worriesAboutFuture               Boolean?
  poorMemoryProblem                Boolean?
  migraineHeadache                 Boolean?
  fearOfPublicSpeaking             Boolean?
  createdAt                        DateTime @default(now())
  updatedAt                        DateTime @updatedAt

  // Relations
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  studentId String  @unique

  @@map("personal_problems")
}

model Internship {
  id           String   @id @default(cuid())
  semester     Int
  type         String
  organisation String
  stipend      Int
  duration     String
  location     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  students Student[]

  @@map("internships")
}

model Project {
  id           String   @id @default(cuid())
  semester     Int
  title        String
  description  String
  technologies String[] @default([])
  mentor       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  students Student[]

  @@map("projects")
}

model CoCurricular {
  id                   String   @id @default(cuid())
  sem                  Int
  date                 DateTime
  eventDetails         String
  participationDetails String
  awards               String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  students Student[]

  @@map("co_curriculars")
}

model Semester {
  id        String   @id @default(cuid())
  semester  Int
  sgpa      Float
  cgpa      Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  students Student[]
  subjects Subject[]

  @@map("semesters")
}


model Subject {
  id           String   @id @default(cuid())
  subjectName  String
  subjectCode  String
  grade        String   // Only grade is stored
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  semesters Semester[]

  @@map("subjects")
}

// Enums & Validation Notes
// Note: Prisma does not enforce complex validation (e.g., email format, password strength). Handle these in backend logic.
enum UserRole {
  STUDENT
  FACULTY
  HOD
  ADMIN
}

enum Gender {
  Male
  Female
}

enum Community {
  General
  OBC
  SC
  ST
  EWS
}